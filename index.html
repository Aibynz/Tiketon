<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Бронирование билетов</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body class="bg-gray-100 text-gray-900">
  <div class="container mx-auto p-4">
    <h1 class="text-2xl font-bold mb-4 text-center">Выберите мероприятие</h1>
    <div id="eventList" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6"></div>

    <div id="seatSection" class="hidden">
      <h2 class="text-xl font-semibold mb-2">Выберите места:</h2>
      <div id="seatList" class="grid grid-cols-5 gap-2 mb-4"></div>
      <button id="bookButton" class="bg-blue-600 text-white px-4 py-2 rounded w-full">
        Забронировать
      </button>
    </div>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const events = [
      { id: 1, name: "Концерт классической музыки", date: "2025-05-01", location: "Филармония" },
      { id: 2, name: "Театр: Ревизор", date: "2025-05-03", location: "Драмтеатр" },
      { id: 3, name: "Балет: Щелкунчик", date: "2025-05-05", location: "ГАТОБ" },
    ];

    let selectedEvent = null;
    let selectedSeats = [];

    const eventList = document.getElementById('eventList');
    const seatSection = document.getElementById('seatSection');
    const seatList = document.getElementById('seatList');
    const bookButton = document.getElementById('bookButton');

    events.forEach(event => {
      const card = document.createElement('div');
      card.className = 'bg-white p-4 rounded shadow cursor-pointer hover:bg-blue-50';
      card.innerHTML = `
        <h3 class="text-lg font-semibold">${event.name}</h3>
        <p class="text-sm text-gray-600">${event.date} — ${event.location}</p>
      `;
      card.onclick = () => selectEvent(event);
      eventList.appendChild(card);
    });

    function selectEvent(event) {
      selectedEvent = event;
      seatSection.classList.remove('hidden');
      seatList.innerHTML = '';
      selectedSeats = [];

      for (let i = 1; i <= 20; i++) {
        const seatBtn = document.createElement('button');
        seatBtn.className = 'bg-gray-200 hover:bg-green-400 px-2 py-1 rounded';
        seatBtn.innerText = i;
        seatBtn.onclick = () => toggleSeat(seatBtn, i);
        seatList.appendChild(seatBtn);
      }
    }

    function toggleSeat(button, seatNumber) {
      if (selectedSeats.includes(seatNumber)) {
        selectedSeats = selectedSeats.filter(s => s !== seatNumber);
        button.classList.remove('bg-green-500');
        button.classList.add('bg-gray-200');
      } else {
        selectedSeats.push(seatNumber);
        button.classList.remove('bg-gray-200');
        button.classList.add('bg-green-500');
      }
    }

    bookButton.onclick = () => {
      if (!selectedEvent || selectedSeats.length === 0) {
        alert("Выберите хотя бы одно место");
        return;
      }
      const booking = {
        event: selectedEvent,
        seats: selectedSeats
      };
      tg.sendData(JSON.stringify(booking));
      tg.close();
    };
  </script>
</body>
</html>
